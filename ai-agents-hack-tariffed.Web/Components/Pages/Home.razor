@page "/"
@using ai_agents_hack_tariffed.ApiService
@rendermode InteractiveServer
@attribute [StreamRendering(true)]

@inject AgentApiClient AgentApi

<PageTitle>TARIFFED! AI Agents Hackathon 2025</PageTitle>

<div class="relative overflow-auto bg-clip-text">
  <div class="mx-auto flex flex-col font-bold font-sans">
    <h1 class="text-8xl flex items-center justify-center bg-gradient-to-r from-cyan-300 to-blue-800 bg-clip-text text-transparent tracking-tighter">
      Tariffed
    </h1>
    <h2 class="flex items-center justify-center text-4xl bg-gradient-to-r from-gray-600 to-gray-800 bg-clip-text text-transparent pb-2">AI Agents Hackathon 2025</h2>
  </div>
  
</div>

<div class="mx-auto mt-12 flex max-w-5xl h-12 items-center overflow-hidden rounded-lg bg-white shadow-lg">
    <div class="grid h-full w-12 place-items-center text-gray-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
    </div>

    <form @onsubmit='() => search(searchQuery)'>
        <InputText @bind-Value=searchQuery
                   class="text-lg w-full font-semibold text-gray-800 outline-none"
                id="search"
                placeholder="See if your favorite stuff just got more expensive" />
    </form>
</div>

<div class="mx-auto mt-12 flex max-w-5xl rounded-lg bg-white px-6 py-8 subpixel-antialiased">
    <div class="water-round-container @activeClass bg-white">
    <div class="water-wave1 bg-gradient-to-r from-red-500 to-red-800"></div>
    <div class="water-wave2 bg-red-600"></div>
    <div class="water-wave3 bg-gradient-to-r from-red-500 to-red-600"></div>
    <div class="round-text">
      <div class="value mb-5">@primaryProducer</div>
      <div class="text-white text-lg font-bold pt-2 pb-4 bg-purple-600 opacity-80 ">
        Primary Producer
        <p class="text-xs font-light leading-2 mt-1">Where most imports come from</p>
      </div>
    </div>
  </div>

    <div class="water-round-container @activeClass bg-white">
    <div class="round-text">
      <div class="value mb-6">140%</div>
      <div class="text-white text-lg font-bold pt-2 pb-4 bg-purple-600 opacity-80 ">
        Tax due upon import
        <p class="text-xs font-light leading-2 mt-1">As a percentage of value</p>
      </div>
    </div>
    <div class="water-wave1 bg-gradient-to-r from-cyan-300 to-green-500"></div>
    <div class="water-wave2 bg-cyan-300"></div>
    <div class="water-wave3 bg-gradient-to-r from-blue-700 to-cyan-300"></div>
    
  </div>

    <div class="water-round-container @activeClass bg-white">
    <div class="round-text">
      <div class="value mb-6">YES</div>
      <div class="text-white text-lg font-bold pt-2 pb-4 bg-purple-600 opacity-80 ">
        Special Trade Agreements
        <p class="text-xs font-light leading-2 mt-1">Could qualify for lower duties</p>
        
      </div>
    </div>
    <div class="water-wave1 bg-gradient-to-r from-cyan-300 to-green-500"></div>
    <div class="water-wave2 bg-cyan-300"></div>
    <div class="water-wave3 bg-gradient-to-r from-blue-700 to-cyan-300"></div>
  </div>
</div>

@code {
    private const string PRIMARY_PRODUCER = "PRIMARY PRODUCER";
    private const string ACTIVE_CLASS = "active";
    private const string LOADING_CLASS = "loading";

    private string primaryProducer = LOADING_CLASS;
    private string activeClass = string.Empty;
    private ApiResponse? response;
    private string searchQuery = string.Empty;


    protected override async Task OnInitializedAsync()
    {
        SetDefaults(response);

        await base.OnInitializedAsync();
    }

    private async Task search(string text)
    {
        searchQuery = text;
        response = null;
        SetDefaults(response);

        response = await AgentApi.GetPrimaryProducerAsync(text);

        if (response != null && response.Message == string.Empty)
        {
            response = null;
        }

        SetDefaults(response);
    }

    private void SetDefaults(ApiResponse? response)
    {
        if (response == null)
        {
            primaryProducer = PRIMARY_PRODUCER;
            activeClass = LOADING_CLASS;
            return;
        }

        primaryProducer = response.Message;
        activeClass = ACTIVE_CLASS;
    }
}